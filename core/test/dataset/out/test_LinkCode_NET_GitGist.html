<head>
    <meta charset="UTF-8">
    <link href="./bootstrap-5.1.3-dist/main.css" rel="stylesheet">
    <script src="./bootstrap-5.1.3-dist/main.js"></script>
    <link rel="stylesheet" href="./main.min.css">
    <link rel="stylesheet" href="./plugin.css">
</head>
<!-- Всплывающие окно с исходным кодом из файла ------------------------------------------ -->
<div id="LinkCodeWindow" onclick="OnHide(event)">
    <div id="LinkCodeWindowDet">
        <div id="LinkCodeWindowButtonTitle">
            <div id="LinkCodeName"></div>
            <input type="button" id="LinkCodeWindowButtonHide" value="Скрыть" onclick="LinkCodeWindow.style.display='none'">
        </div>
        <pre class="code" id="LinkCodeWindowBody">
        </pre>
    </div>
</div>
<!-- ---------------------------------------------------------------------------------------- -->
Вот реальный пример, берем код из `GitGist`

<a class ="MarkdownDRY LinkCode" file="https:/gist.githubusercontent.com/denisxab/4290770428d4d34a83624f5343df87fd/raw/3fd17298a2dd382d0a2c52e4e11e2993f9b2da0b/SymmetricCrypto.py" ref="SymmetricCrypto.check_uniq_key" char_start="1074" char_end="1601">check_uniq_key</a>

<br>
<a class ="MarkdownDRY LinkCode" file="https:/gist.githubusercontent.com/denisxab/4290770428d4d34a83624f5343df87fd/raw/3fd17298a2dd382d0a2c52e4e11e2993f9b2da0b/SymmetricCrypto.py" ref="SymmetricCrypto.crypto" char_start="3224" char_end="3472">crypto</a>



<script>
/* -------------------------- Логика для LinkCode -------------------------- */
// Переменная для хранения исходного кода из файлов. Храниться в кодировки UTF-8, для экранирования спец символов
LinkSourceCode={
    "https:/gist.githubusercontent.com/denisxab/4290770428d4d34a83624f5343df87fd/raw/3fd17298a2dd382d0a2c52e4e11e2993f9b2da0b/SymmetricCrypto.py":decodeURIComponent(escape(atob('aW1wb3J0IHJhbmRvbQppbXBvcnQgc2VjcmV0cwppbXBvcnQgdGltZQpmcm9tIGNvbGxlY3Rpb25zIGltcG9ydCBkZXF1ZQpmcm9tIHBwcmludCBpbXBvcnQgcHByaW50CgoKY2xhc3MgU3ltbWV0cmljQ3J5cHRvOgogICAgQ0hBUl9BUlI6IHR1cGxlID0gKAogICAgICAgICfQsCcsICfQsScsICfQsicsICfQsycsICfQtCcsICfQtScsICfRkScsICfQticsICfQtycsICfQuCcsCiAgICAgICAgJ9C5JywgJ9C6JywgJ9C7JywgJ9C8JywgJ9C9JywgJ9C+JywgJ9C/JywgJ9GAJywgJ9GBJywgJ9GCJywKICAgICAgICAn0YMnLCAn0YQnLCAn0YUnLCAn0YYnLCAn0YcnLCAn0YgnLCAn0YknLCAn0YonLCAn0YsnLCAn0YwnLAogICAgICAgICfRjScsICfRjicsICfRjycsICfQkCcsICfQkScsICfQkicsICfQkycsICfQlCcsICfQlScsICfQgScsCiAgICAgICAgJ9CWJywgJ9CXJywgJ9CYJywgJ9CZJywgJ9CaJywgJ9CbJywgJ9CcJywgJ9CdJywgJ9CeJywgJ9CfJywKICAgICAgICAn0KAnLCAn0KEnLCAn0KInLCAn0KMnLCAn0KQnLCAn0KUnLCAn0KYnLCAn0KcnLCAn0KgnLCAn0KknLAogICAgICAgICfQqicsICfQqycsICfQrCcsICfQrScsICfQricsICfQrycsCgogICAgICAgICcxJywgJzInLCAnMycsICc0JywgJzUnLCAnNicsICc3JywgJzgnLCAnOScsICcwJywKICAgICAgICAnICcsICcmJywgJz8nLCAnQCcsICchJywgJzonLCAnLicsICcsJywgJ1wnJywKICAgICAgICAnXCInLCAnKCcsICcpJywgJy0nLCAnKycsICc9JywgJ18nLCAn4oCTJywgJyMnLCAnOycsCiAgICAgICAgJ1xuJywgJ1x0JywgJ1xcJywgJy8nLCAnfCcsCgogICAgICAgICdhJywgJ2InLCAnYycsICdkJywgJ2UnLCAnZicsICdnJywgJ2gnLCAnaScsICdqJywKICAgICAgICAnaycsICdsJywgJ20nLCAnbicsICdvJywgJ3AnLCAncScsICdyJywgJ3MnLCAndCcsCiAgICAgICAgJ3UnLCAndicsICd3JywgJ3gnLCAneScsICd6JywgJ0EnLCAnQicsICdDJywgJ0QnLAogICAgICAgICdFJywgJ0YnLCAnRycsICdIJywgJ0knLCAnSicsICdLJywgJ0wnLCAnTScsICdOJywKICAgICAgICAnTycsICdQJywgJ1EnLCAnUicsICdTJywgJ1QnLCAnVScsICdWJywgJ1cnLCAnWCcsCiAgICAgICAgJ1knLCAnWicsCiAgICApCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGNoZWNrX3VuaXFfa2V5KGtleTogZGljdFtzdHIsIGxpc3RbaW50XV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAg0KTRg9C90LrRhtC40Y8g0LTQu9GPINC/0YDQvtCy0LXRgNC60Lgg0YPQvdC40LrQsNC70YzQvdC+0YHRgtC4INCy0YHQtdGFINC30L3QsNGH0LXQvdC40Lkg0LIgYGtleWAKCiAgICAgICAgOnBhcmFtIGtleTog0JLQt9GP0YLRjCDQvdCw0L/RgNC40LzQtdGAINC40Lcg0LzQtdGC0L7QtNCwIGBnZW5lcmF0ZV9yYW5kb21fYXJyKClgCiAgICAgICAgIiIiCiAgICAgICAgdXNlZF9jaGFyOiBzZXRbaW50XSA9IHNldCgpCiAgICAgICAgZm9yIF9rLCBfdiBpbiBrZXkuaXRlbXMoKToKICAgICAgICAgICAgZm9yIF95IGluIF92OgogICAgICAgICAgICAgICAgaWYgbm90IF95IGluIHVzZWRfY2hhcjoKICAgICAgICAgICAgICAgICAgICB1c2VkX2NoYXIuYWRkKF95KQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGYi0KHQuNC80LLQvtC7IGB7X2t9YCDRgdC+0LTQtdGA0LbQuNGCINC90LUg0YPQvdC40LrQsNC70YzQvdC+0LUg0LfQvdCw0YfQtdC90LjQtSBge195fWAiKQogICAgICAgIHJldHVybiBUcnVlCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgZ2VuZXJhdGVfcmFuZG9tX2FycihjbHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW5fYXJyOiBpbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5fcmFuZG9tX2ludDogaW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4X3JhbmRvbV9pbnQ6IGludCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZWRfOiBpbnQgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKSAtPiBkaWN0W3N0ciwgbGlzdFtpbnRdXToKICAgICAgICAiIiIKICAgICAgICDQk9C10L3QtdGA0LjRgNGD0LXQvCDRgdC70YPRh9Cw0LnQvdGLINC30L3QsNGH0LXQvdC40Lkg0LTQu9GPINC60LvRjtGH0LXQuSDRgdC70L7QstCw0YDRjAoKICAgICAgICA6cGFyYW0gbGVuX2Fycjog0JTQu9C40L3QvdCwINGB0LvRg9GH0LDQudC90YvRhSDRh9C40YHQtdC7CiAgICAgICAgOnBhcmFtIG1pbl9yYW5kb21faW50OiDQnNC40L3QuNC80LDQu9GM0L3QvtC1INGH0LjRgdC70L4g0LTQu9GPICBgcmFuZG9tLnJhbmRpbnRgCiAgICAgICAgOnBhcmFtIG1heF9yYW5kb21faW50OiDQnNCw0LrRgdC40LzQsNC70YzQvdC+0LUg0YfQuNGB0LvQviDQtNC70Y8gIGByYW5kb20ucmFuZGludGAKICAgICAgICA6cGFyYW0gc2VlZF86INCX0LXRgNC90L4g0LTQu9GPINCz0LXQvdC10YDQsNGC0L7RgNCwIGByYW5kb20uc2VlZChzZWVkXylgCiAgICAgICAgIiIiCgogICAgICAgIGRlZiBnZXRfcmFuZG9tX2FycigpIC0+IGxpc3RbaW50XToKICAgICAgICAgICAgIyBhID0gWzEsMiwzLDRdCiAgICAgICAgICAgIHRtcF9hcnIgPSBbXQogICAgICAgICAgICB3aGlsZSBsZW4odG1wX2FycikgIT0gbGVuX2FycjoKICAgICAgICAgICAgICAgIHRtcCA9IHJhbmRvbS5yYW5kaW50KG1pbl9yYW5kb21faW50LCBtYXhfcmFuZG9tX2ludCkKICAgICAgICAgICAgICAgIGlmIG5vdCB0bXAgaW4gdXNlZF9jaGFyOgogICAgICAgICAgICAgICAgICAgIHVzZWRfY2hhci5hZGQodG1wKQogICAgICAgICAgICAgICAgICAgIHRtcF9hcnIuYXBwZW5kKHRtcCkKICAgICAgICAgICAgcmV0dXJuIHRtcF9hcnIKCiAgICAgICAgc2VlZF8gPSBzZWVkXyBpZiBzZWVkXyBlbHNlIGludCh0aW1lLnRpbWUoKSkKICAgICAgICByYW5kb20uc2VlZChzZWVkXykKICAgICAgICB1c2VkX2NoYXIgPSBzZXQoKQogICAgICAgIGNoYXJfZGljdDogZGljdFtzdHIsIGxpc3RbaW50XV0gPSB7fQogICAgICAgIGZvciBfeCBpbiBjbHMuQ0hBUl9BUlI6CiAgICAgICAgICAgIGNoYXJfZGljdFtfeF0gPSBnZXRfcmFuZG9tX2FycigpCiAgICAgICAgcmV0dXJuIGNoYXJfZGljdAoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBSZXZlcnNlVHJhbnNlY3RzTWFwKHRyYW5zbGF0ZV9tYXA6IGRpY3Rbc3RyLCBsaXN0W2ludF1dKSAtPiBkaWN0W3N0ciwgc3RyXToKICAgICAgICByZXM6IGRpY3Rbc3RyLCBzdHJdID0ge30KICAgICAgICBmb3IgX2ssIF9hcnJheV92YWx1ZSBpbiB0cmFuc2xhdGVfbWFwLml0ZW1zKCk6CiAgICAgICAgICAgIGZvciBfdiBpbiBfYXJyYXlfdmFsdWU6CiAgICAgICAgICAgICAgICByZXNbc3RyKF92KV0gPSBfawoKICAgICAgICAjIHByaW50KCIxIiwgc3RyKHRyYW5zbGF0ZV9tYXApWzoyMDBdKQogICAgICAgICMgcHJpbnQoIjIiLCBzdHIocmVzKVs6MjAwXSkKICAgICAgICByZXR1cm4gcmVzCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGNyeXB0byh0ZXh0OiBzdHIsIHRyYW5zbGF0ZV9tYXA6IGRpY3Rbc3RyLCBsaXN0W2ludF1dKSAtPiBzdHI6CiAgICAgICAgcmVzOiBkZXF1ZVtzdHJdID0gZGVxdWUoKQogICAgICAgIGZvciBfY2hhciBpbiB0ZXh0OgogICAgICAgICAgICB0bXAgPSBzZWNyZXRzLmNob2ljZSh0cmFuc2xhdGVfbWFwW19jaGFyXSkKICAgICAgICAgICAgcmVzLmFwcGVuZChzdHIodG1wKSkKICAgICAgICByZXR1cm4gInwiLmpvaW4ocmVzKQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBkZWNyeXB0byh0ZXh0OiBzdHIsIHJldmVyc2VfdHJhbnNsYXRlX21hcDogZGljdFtzdHIsIHN0cl0pIC0+IHN0cjoKICAgICAgICByZXMgPSBbXQogICAgICAgIGZvciBfY2hhciBpbiB0ZXh0LnNwbGl0KCJ8Iik6CiAgICAgICAgICAgIHRtcCA9IHJldmVyc2VfdHJhbnNsYXRlX21hcC5nZXQoX2NoYXIsIEZhbHNlKQogICAgICAgICAgICBpZiB0bXA6CiAgICAgICAgICAgICAgICByZXMuYXBwZW5kKHRtcCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoItCd0LXQstC10YDQvdGL0LUg0LTQsNC90L3Ri9C1IikKICAgICAgICByZXR1cm4gIiIuam9pbihyZXMpCgoKaWYgX19uYW1lX18gPT0gJ19fbWFpbl9fJzoKICAgIHJlcyA9IFN5bW1ldHJpY0NyeXB0by5nZW5lcmF0ZV9yYW5kb21fYXJyKGxlbl9hcnI9NCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZWRfPTQ0NDQyMzQyNDM0NDQ0NDQ0NCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbl9yYW5kb21faW50PS02MDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhfcmFuZG9tX2ludD04ODgpCiAgICBwcHJpbnQocmVzKQogICAgcHByaW50KFN5bW1ldHJpY0NyeXB0by5jaGVja191bmlxX2tleShyZXMpKQoKICAgIHRleHQgPSBTeW1tZXRyaWNDcnlwdG8uY3J5cHRvKCLQn9GA0LjQstC10YIiLCByZXMpCiAgICBwcmludCh0ZXh0KQoKICAgIHJldmVyc2VfdHJhbnNsYXRlX21hcCA9IFN5bW1ldHJpY0NyeXB0by5SZXZlcnNlVHJhbnNlY3RzTWFwKHJlcykKICAgIHByaW50KFN5bW1ldHJpY0NyeXB0by5kZWNyeXB0byh0ZXh0LCByZXZlcnNlX3RyYW5zbGF0ZV9tYXApKQ==')))
};

function AddEventLinkCode() {
    /* Добавление обработка нажатий на ссылки */
    
    let elm = document.querySelectorAll(".MarkdownDRY.LinkCode");
    elm.forEach((e) => {
        e.addEventListener("click", () => {
            DisplayLinkCode(e);
        });
    });
}
AddEventLinkCode();
function DisplayLinkCode(_elem) {
    /* Показать всплывающие окно с исходным кодом */
    
    // Устанавливаем в заголовок всплывающего окна, название ссылки которая вызвала это окно
    LinkCodeName.textContent=_elem.textContent

    // Получаем элемент в котором будет исходный текст из файла
    let _el = document.querySelector('#LinkCodeWindowBody')
    const source_text = LinkSourceCode[_elem.getAttribute('file')]
    if (source_text) {
        // --- Вставка кода в всплывающие окно --- //
        _el.innerHTML = toTag(source_text, 'code', 0, 0, 0, true);
        // --- Выделение кода --- //
        const char_start = _elem.getAttribute('char_start');
        const char_end = _elem.getAttribute('char_end');
        if (char_start > 0 && char_end > 0) {
            // Выделяем текст согласно диапазону из ссылки. Если конечно такой диапазон есть.
            // Его может не быть если ссылка указывает на несуществующий элемент кода.              
            const highlight_text = toTag(toTag(_el.textContent.slice(char_start, char_end), 'span', 0, 0, 0, true), 'code', true);
            // Собираем результат, и записываем его в тело всплывающего окна
            _el.innerHTML = `${toTag(_el.textContent.slice(0, char_start), 'code', null, null, true, true)}` +
                `${highlight_text}` +
                `${toTag(_el.textContent.slice(char_end, _el.innerHTML.length), 'code', null, true, null, true)}`
        }
        // ------------------------------------------------------------- //        
    }
    // Делаем видимым окно
    LinkCodeWindow.style.display = 'block';
    // Перебираем все строки и ищем начало выделение кода
    for (let _e of _el.childNodes) {
        if (_e.childNodes.length > 0 && _e.childNodes[0].tagName === "SPAN") {
            // Плавная прокрутка к первому выделенному блоку
            _e.scrollIntoView({ behavior: 'smooth'});
            break;
        }
    }
}
function toTag(text, tag, is_skip_first_last, skip_first, skip_last, escaping) {
    /*Поместить текст в теги

    is_skip_first_last=true - Если нужно пропустить первый и последний тег.
    escaping=true -  Экранирование треугольных скобок, если этого не сделать то метод `innerHTML` скроет текст в скобках.
    */

    let list = [];
    if (escaping) {
        text = text.replace(/</g,'&lt').replace(/>/g,'&gt');
    }
    const tmp = text.split('\n');

    if (!is_skip_first_last) {
        if (skip_last) {
            tmp.slice(0, -1).forEach(
                (_e) => {
                    list.push(`<${tag}>${_e}</${tag}>`);
                }
            )
            list.push(`<${tag}>${tmp[tmp.length - 1]}`)
        } else if (skip_first) {
            list.push(`</${tag}>${tmp[0]}`)
            tmp.slice(1, -1).forEach(
                (_e) => {
                    list.push(`<${tag}>${_e}</${tag}>`);
                }
            )
        } else {
            tmp.forEach(
                (_e) => {
                    list.push(`<${tag}>${_e}</${tag}>`);
                }
            )
        }
    } else {
        // Если нужно пропустить первый и последний тег
        list.push(tmp[0])
        tmp.slice(1).forEach(
            (_e) => {
                list.push(`<${tag}>${_e}</${tag}>`);
            }
        )
        // list.push(tmp[tmp.length - 1])
    }
    return list.join('\n');
}
function OnHide(_event) {
    /* Скрыть выплывающие окно при нажатии вне его */
    
    console.log('OnHide');
    if (_event.target.id === 'LinkCodeWindow') {
        LinkCodeWindow.style.display = 'none'
    }
}

/* --------------------------------------------------------------------------------------------- */
</script>
