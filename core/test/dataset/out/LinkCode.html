<head>
    <meta charset="UTF-8">
    <link href="./bootstrap-5.1.3-dist/main.css" rel="stylesheet">
    <script src="./bootstrap-5.1.3-dist/main.js"></script>
    <link rel="stylesheet" href="./main.min.css">
    <link rel="stylesheet" href="./plugin.css">
</head>
<!-- Всплывающие окно с исходным кодом из файла ------------------------------------------ -->
<div id="LinkCodeWindow" onclick="OnHide(event)">
    <div id="LinkCodeWindowDet">
        <div id="LinkCodeWindowButtonTitle">
            <div id="LinkCodeName"></div>
            <input type="button" id="LinkCodeWindowButtonHide" value="Скрыть" onclick="LinkCodeWindow.style.display='none'">
        </div>
        <pre class="code" id="LinkCodeWindowBody">
        </pre>
    </div>
    <div id="LinkCodeWindowFooter">
        <div id="LinkCodeWindowPath"></div>
    </div>
</div>
<!-- ---------------------------------------------------------------------------------------- -->
<br>Нормальные примеры
<br><a class ="MarkdownDRY LinkCode" file="LinkCode.py" ref="NeClass" char_start="48" char_end="173">Имя Для Ссылки1</a>

<br><a class ="MarkdownDRY LinkCode" file="LinkCode.py" ref="NeClass.name" char_start="63" char_end="87">Имя Для Ссылки2</a>

<br><a class ="MarkdownDRY LinkCode" file="LinkCode.py" ref="NeClass.__call__" char_start="89" char_end="173">Имя Для Ссылки3</a>

<br><a class ="MarkdownDRY LinkCode" file="LinkCode.py" ref="another_function" char_start="176" char_end="501">Имя Для Ссылки4</a>

<br><a class ="MarkdownDRY LinkCode" file="LinkCode.py" ref="__name__" char_start="1251" char_end="1272">Имя Для Ссылки5</a>

<br><a class ="MarkdownDRY LinkCode" file="LinkCode.py" ref="Химичим" char_start="378" char_end="443">Имя Для Ссылки6</a>

<br><a class ="MarkdownDRY LinkCode" file="LinkCode2.py" ref="__name__" char_start="85" char_end="106">Имя Для Ссылки7</a>

<br><a class ="MarkdownDRY LinkCode" file="LinkCode2.py" ref="ДелаемДела" char_start="153" char_end="197">Имя Для Ссылки8</a>


<br>Вот что будет если указать несуществующие элементы
<br><a class ="MarkdownDRY LinkCode" file="LinkCode.py" ref="Скучаем" char_start="0" char_end="0">Имя Для Ссылки9</a>

<br><a class ="MarkdownDRY LinkCode" file="LinkCode2.py" ref="another_function" char_start="0" char_end="0">Имя Для Ссылки10</a>

<br><a class ="MarkdownDRY LinkCode" file="LinkCode.py" ref="__file__" char_start="0" char_end="0">Имя Для Ссылки11</a>

<br><a class ="MarkdownDRY LinkCode" file="LinkCode.py" ref="NeClass.__init__" char_start="0" char_end="0">Имя Для Ссылки12</a>


<br>Указание файла который еще не поддерживается, или же нет расширения
<br><a class ="MarkdownDRY LinkCode" file="LinkCode3.md" ref="Делаем" char_start="206" char_end="393">Имя Для Ссылки13</a>

<br><a class ="MarkdownDRY LinkCode" file="LinkCode4" ref="Строим" char_start="82" char_end="374">Имя Для Ссылки14</a>



<script>
/* -------------------------- Логика для LinkCode -------------------------- */
// Переменная для хранения исходного кода из файлов. Храниться в кодировки UTF-8, для экранирования спец символов
LinkSourceCode={
    "LinkCode.py":decodeURIComponent(escape(atob('IyDQntCx0YvRh9C90LDRjyDRhNGD0L3QutGG0LjRjwpmcm9tIGZ1bmN0b29scyBpbXBvcnQgd3JhcHMKCgpjbGFzcyBOZUNsYXNzOgogICAgbmFtZTogc3RyID0gX19maWxlX18KCiAgICBkZWYgX19jYWxsX18oc2VsZiwgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICAiIiLQlNC+0LrQuCIiIgogICAgICAgIHJldHVybiBzZWxmLm5hbWUKCgpkZWYgYW5vdGhlcl9mdW5jdGlvbihmdW5jKToKICAgICIiIgogICAg0KTRg9C90LrRhtC40Y8g0LrQvtGC0L7RgNCw0Y8g0L/RgNC40L3QuNC80LDQtdGCINC00YDRg9Cz0YPRjiDRhNGD0L3QutGG0LjRjgogICAgIiIiCgogICAgQHdyYXBzKGZ1bmMpICAjICEhCiAgICBkZWYgd3JhcHBlcigpOgogICAgICAgICIiIgogICAgICAgINCe0LHQtdGA0YLQvtGH0L3QsNGPINGE0YPQvdC60YbQuNGPCiAgICAgICAgIiIiCiAgICAgICAgIyDQpdC40LzQuNGH0LjQvD4KCiAgICAgICAgdmFsID0gIlRoZSByZXN1bHQgb2YgJXMgaXMgJXMiICUgKGZ1bmMoKSwgZXZhbChmdW5jKCkpKQoKICAgICAgICAjIDzQpdC40LzQuNGH0LjQvAogICAgICAgIHJldHVybiB2YWwKCiAgICByZXR1cm4gd3JhcHBlcgoKCkBhbm90aGVyX2Z1bmN0aW9uCmRlZiBhX2Z1bmN0aW9uKCk6CiAgICAiIiLQntCx0YvRh9C90LDRjyBg0YTRg9C90LrRhtC40Y9gIiIiCiAgICByZXR1cm4gIjErMSIKCgpAYW5vdGhlcl9mdW5jdGlvbgpkZWYgYV9mdW5jdGlvbigpOgogICAgIiIi0J7QsdGL0YfQvdCw0Y8gYNGE0YPQvdC60YbQuNGPYCIiIgogICAgcmV0dXJuICIxKzEiCgoKQGFub3RoZXJfZnVuY3Rpb24KZGVmIGFfZnVuY3Rpb24oKToKICAgICIiItCe0LHRi9GH0L3QsNGPIGDRhNGD0L3QutGG0LjRj2AiIiIKICAgIHJldHVybiAiMSsxIgoKCkBhbm90aGVyX2Z1bmN0aW9uCmRlZiBhX2Z1bmN0aW9uKCk6CiAgICAiIiLQntCx0YvRh9C90LDRjyBg0YTRg9C90LrRhtC40Y9gIiIiCiAgICByZXR1cm4gIjErMSIKCgpAYW5vdGhlcl9mdW5jdGlvbgpkZWYgYV9mdW5jdGlvbigpOgogICAgIiIi0J7QsdGL0YfQvdCw0Y8gYNGE0YPQvdC60YbQuNGPYCIiIgogICAgcmV0dXJuICIxKzEiCgoKQGFub3RoZXJfZnVuY3Rpb24KZGVmIGFfZnVuY3Rpb24oKToKICAgICIiItCe0LHRi9GH0L3QsNGPIGDRhNGD0L3QutGG0LjRj2AiIiIKICAgIHJldHVybiAiMSsxIgoKCkBhbm90aGVyX2Z1bmN0aW9uCmRlZiBhX2Z1bmN0aW9uKCk6CiAgICAiIiLQntCx0YvRh9C90LDRjyBg0YTRg9C90LrRhtC40Y9gIiIiCiAgICByZXR1cm4gIjErMSIKCgpAYW5vdGhlcl9mdW5jdGlvbgpkZWYgYV9mdW5jdGlvbigpOgogICAgIiIi0J7QsdGL0YfQvdCw0Y8gYNGE0YPQvdC60YbQuNGPYCIiIgogICAgcmV0dXJuICIxKzEiCgoKQGFub3RoZXJfZnVuY3Rpb24KZGVmIGFfZnVuY3Rpb24oKToKICAgICIiItCe0LHRi9GH0L3QsNGPIGDRhNGD0L3QutGG0LjRj2AiIiIKICAgIHJldHVybiAiMSsxIgoKCl9fbmFtZV9fID0gJ19fbWFpbl9fJwoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIHByaW50KGFfZnVuY3Rpb24uX19uYW1lX18pICAjIGFfZnVuY3Rpb24KICAgIHByaW50KGFfZnVuY3Rpb24uX19kb2NfXykgICMg0J7QsdGL0YfQvdCw0Y8g0YTRg9C90LrRhtC40Y8K'))),"LinkCode2.py":decodeURIComponent(escape(atob('IyDQntCx0YvRh9C90LDRjyDRhNGD0L3QutGG0LjRjwoKCmRlZiBhX2Z1bmN0aW9uKCk6CiAgICAiIiLQntCx0YvRh9C90LDRjyBg0YTRg9C90LrRhtC40Y9gIiIiCiAgICByZXR1cm4gIjErMSIKCgpfX25hbWVfXyA9ICdfX21haW5fXycKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICAjINCU0LXQu9Cw0LXQvNCU0LXQu9CwPgogICAgcHJpbnQoYV9mdW5jdGlvbi5fX25hbWVfXykgICMgYV9mdW5jdGlvbgogICAgIyA80JTQtdC70LDQtdC80JTQtdC70LAKICAgIHByaW50KGFfZnVuY3Rpb24uX19kb2NfXykgICMg0J7QsdGL0YfQvdCw0Y8g0YTRg9C90LrRhtC40Y8K'))),"LinkCode3.md":decodeURIComponent(escape(atob('fCDQpNGD0L3QutGG0LjQuCBgcmVxdWVzdHNgIHwg0J7Qv9C40YHQsNC90LjQtSAgICAgICAgICAgICAgICB8CnwgLS0tLS0tLS0tLS0tLS0tLS0tIHwgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gfAp8IGByZXF1ZXN0cy5nZXQoKWAgICB8INCe0YLQv9GA0LDQstC40YLRjCBgR0VUYCDQt9Cw0L/RgNC+0YEgIHwKfCBgcmVxdWVzdHMucG9zdCgpYCAgfCDQntGC0L/RgNCw0LLQuNGC0YwgYFBPU1RgINC30LDQv9GA0L7RgSB8CgoK0JTQtdC70LDQtdC8PgotIGBkYXRhOmRpY3RgID3QlNCw0L3QvdGL0LUg0LIgYFBPU1RgCi0gYGpzb246anNvbmAgPSDQn9C10YDQtdC00LDRgtGMINC00LDQvdC90YvQtSDQsiDQstC40LTQtSBgSnNvbmAgKGBQT1NUYCkKLSBgcGFyYW1zOmRpY3RgID0g0JTQsNC90L3Ri9C1INCyIGBHRVRgCi0gYGhlYWRlcnM6ZGljdGAgPSDQl9Cw0LPQvtC70L7QstC60Lgg0LIg0LfQsNC/0YDQvtGBCi0gYGZpbGU6Ynl0ZXNgID0g0J/QtdGA0LXQtNCw0YLRjCDRhNCw0LnQuwo80JTQtdC70LDQtdC8Ci0gYGNvb2tpZXM6ZGljdGAgPSDQn9C10YDQtdC00LDRgtGMINC60YPQutC4Ci0gYHByb3hpZXM6ZGljdGA9INCh0L/QuNGB0L7QuiDQv9GA0L7QutGB0LggYHsnPNCf0YDQvtGC0L7QutC+0LvQn9GA0LjQutC70LDQtNC90L7Qs9C+0KPRgNC+0LLQvdGPPic6ICc80J/RgNC+0YLQvtC60L7Quz46Ly88SXA+OjxQb3J0Pid9YCAoYHsnaHR0cCc6ICdzb2NrczU6Ly81LjQyLjE1OC4xMToxMDgwJ31gKQotIGB0aW1lb3V0OmludGAgPSDQodC60L7Qu9GM0LrQviDQvNCw0LrRgdC40LzRg9C8INGB0LXQutGD0L3QtCDQttC00LDRgtGMINC+0YLQstC10YIg0L7RgiDRgdC10YDQstC10YDQsA=='))),"LinkCode4":decodeURIComponent(escape(atob('YGBgcHl0aG9uCkJlYXV0aWZ1bFNvdXAoPEhUTUxf0JTQvtC60YPQvNC10L3Rgj4sPNCf0LDRgNGB0LXRgD4pICMgLT4gQmVhdXRpZnVsU291cApgYGAKCtCh0YLRgNC+0LjQvD4KCmBgYHB5dGhvbgpCZWF1dGlmdWxTb3VwKDxIVE1MX9CU0L7QutGD0LzQtdC90YI+LDzQn9Cw0YDRgdC10YA+KSAjIC0+IEJlYXV0aWZ1bFNvdXAKYGBgCmBgYHB5dGhvbgpCZWF1dGlmdWxTb3VwKDxIVE1MX9CU0L7QutGD0LzQtdC90YI+LDzQn9Cw0YDRgdC10YA+KSAjIC0+IEJlYXV0aWZ1bFNvdXAKYGBgCmBgYHB5dGhvbgpCZWF1dGlmdWxTb3VwKDxIVE1MX9CU0L7QutGD0LzQtdC90YI+LDzQn9Cw0YDRgdC10YA+KSAjIC0+IEJlYXV0aWZ1bFNvdXAKYGBgYGBgcHl0aG9uCkJlYXV0aWZ1bFNvdXAoPEhUTUxf0JTQvtC60YPQvNC10L3Rgj4sPNCf0LDRgNGB0LXRgD4pICMgLT4gQmVhdXRpZnVsU291cApgYGAKCgo80KHRgtGA0L7QuNC8CgoK')))
};

function AddEventLinkCode() {
    /* Добавление обработка нажатий на ссылки */
    
    let elm = document.querySelectorAll(".MarkdownDRY.LinkCode");
    elm.forEach((e) => {
        e.addEventListener("click", () => {
            DisplayLinkCode(e);
        });
    });
}
AddEventLinkCode();
function DisplayLinkCode(_elem) {
    /* Показать всплывающие окно с исходным кодом */
    
    // Устанавливаем в заголовок всплывающего окна, название ссылки которая вызвала это окно
    LinkCodeName.textContent=_elem.textContent
    
    // Установить путь к файлу или ссылку в выплывающие окно
    LinkCodeWindowPath.textContent=_elem.getAttribute('file')

    // Получаем элемент в котором будет исходный текст из файла
    let _el = document.querySelector('#LinkCodeWindowBody')
    const source_text = LinkSourceCode[_elem.getAttribute('file')]
    if (source_text) {
        // --- Вставка кода в всплывающие окно --- //
        _el.innerHTML = toTag(source_text, 'code', 0, 0, 0, true);
        // --- Выделение кода --- //
        const char_start = _elem.getAttribute('char_start');
        const char_end = _elem.getAttribute('char_end');
        if (char_start > 0 && char_end > 0) {
            // Выделяем текст согласно диапазону из ссылки. Если конечно такой диапазон есть.
            // Его может не быть если ссылка указывает на несуществующий элемент кода.              
            const highlight_text = toTag(toTag(_el.textContent.slice(char_start, char_end), 'span', 0, 0, 0, true), 'code', true);
            // Собираем результат, и записываем его в тело всплывающего окна
            _el.innerHTML = `${toTag(_el.textContent.slice(0, char_start), 'code', null, null, true, true)}` +
                `${highlight_text}` +
                `${toTag(_el.textContent.slice(char_end, _el.innerHTML.length), 'code', null, true, null, true)}`
        }
        // ------------------------------------------------------------- //        
    }
    // Делаем видимым окно
    LinkCodeWindow.style.display = 'block';
    // Перебираем все строки и ищем начало выделение кода
    for (let _e of _el.childNodes) {
        if (_e.childNodes.length > 0 && _e.childNodes[0].tagName === "SPAN") {
            // Плавная прокрутка к первому выделенному блоку
            _e.scrollIntoView({ behavior: 'smooth'});
            break;
        }
    }
}
function toTag(text, tag, is_skip_first_last, skip_first, skip_last, escaping) {
    /*Поместить текст в теги

    is_skip_first_last=true - Если нужно пропустить первый и последний тег.
    escaping=true -  Экранирование треугольных скобок, если этого не сделать то метод `innerHTML` скроет текст в скобках.
    */

    let list = [];
    if (escaping) {
        text = text.replace(/</g,'&lt').replace(/>/g,'&gt');
    }
    const tmp = text.split('\n');

    if (!is_skip_first_last) {
        if (skip_last) {
            tmp.slice(0, -1).forEach(
                (_e) => {
                    list.push(`<${tag}>${_e}</${tag}>`);
                }
            )
            list.push(`<${tag}>${tmp[tmp.length - 1]}`)
        } else if (skip_first) {
            list.push(`</${tag}>${tmp[0]}`)
            tmp.slice(1, -1).forEach(
                (_e) => {
                    list.push(`<${tag}>${_e}</${tag}>`);
                }
            )
        } else {
            tmp.forEach(
                (_e) => {
                    list.push(`<${tag}>${_e}</${tag}>`);
                }
            )
        }
    } else {
        // Если нужно пропустить первый и последний тег
        list.push(tmp[0])
        tmp.slice(1).forEach(
            (_e) => {
                list.push(`<${tag}>${_e}</${tag}>`);
            }
        )
        // list.push(tmp[tmp.length - 1])
    }
    return list.join('\n');
}
function OnHide(_event) {
    /* Скрыть выплывающие окно при нажатии вне его */
    
    console.log('OnHide');
    if (_event.target.id === 'LinkCodeWindow') {
        LinkCodeWindow.style.display = 'none'
    }
}

/* --------------------------------------------------------------------------------------------- */
</script>
